<?php $themeHelper = $this->helper('MGS\StoreLocator\Helper\Data'); ?> <?php if ($themeHelper->getStoreConfig('locator/general/store_api_key')) { $apikey = $themeHelper->getStoreConfig('locator/general/store_api_key'); } else { $apikey = 'AIzaSyD11c9ZFjYyFvKmbp2eKkpRuiqkjkAUIG0'; } ?> <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=<?php echo $apikey ?>&libraries=places" async defer></script><?php $markers = array(); $agruments = []; if ($curPage = $this->getRequest()->getParam('p', false)) { $agruments['p'] = $curPage; } $state = $this->getRequest()->getParam('state', ''); $location = $this->getRequest()->getParam('location', ''); ?> <?php echo $block->getLayout()->getMessagesBlock()->getGroupedHtml() ?> <div class="view-builders"><div class="canvas"><div class="page"><div class="container"><div class="row"><div class="col-sm-12"><?php echo $this->getLayout() ->createBlock('Magento\Cms\Block\Block') ->setBlockId('find-a-builder-header') ->toHtml(); ?></div></div></div><div class="container"><div class="row"><div class="col-sm-12"><form action="<?php echo $block->getUrl('locator/index/searchbydistance', $agruments) ?>" method="GET"><div class="map-canvas"><?= /* @noEscape */ $block->getBlockHtml('formkey'); ?> <div class="map-controls"><div class="filter"><div class="dropdown"><button class="btn btn-default btn-input dropdown-toggle" type="button" data-toggle="dropdown">Select a State <i class="fa fa-caret-down"></i></button> <ul name="state" id="state" class="dropdown-menu"><li><a href="<?php echo $block->getUrl('find-a-builder'); ?>">All Builders</a></li> <li role="separator" class="divider"></li> <li><a href="<?php echo $block->getUrl('find-a-builder/index/builderstate/state/illinois'); ?>">Illinois</a></li> <li><a href="<?php echo $block->getUrl('find-a-builder/index/builderstate/state/indiana'); ?>">Indiana</a></li> <li><a href="<?php echo $block->getUrl('find-a-builder/index/builderstate/state/iowa'); ?>">Iowa</a></li> <!-- <li><a href="<?php ?>">Kansas</a></li> <li><a href="<?php ?>">Kentucky</a></li> --><li><a href="<?php echo $block->getUrl('find-a-builder/index/builderstate/state/michigan'); ?>">Michigan</a></li> <li><a href="<?php echo $block->getUrl('find-a-builder/index/builderstate/state/minnesota'); ?>">Minnesota</a></li> <li><a href="<?php echo $block->getUrl('find-a-builder/index/builderstate/state/missouri'); ?>">Missouri</a></li> <li><a href="<?php echo $block->getUrl('find-a-builder/index/builderstate/state/south-dakota'); ?>">South Dakota</a></li> <li><a href="<?php echo $block->getUrl('find-a-builder/index/builderstate/state/wisconsin'); ?>">Wisconsin</a></li></ul></div></div><div class="search"><div class="input-group custom-height-input"><input type="text" name="location" id="location" value="<?php echo $location; ?>" class="form-control js-search" placeholder="Search by City or Zip..."><div class="input-group-btn"><button type="submit" class="btn btn-default js-zipcode"><i class="fa fa-search"></i></button> <button type="button" onclick="drawMap(markers, googleMapDivId);" class="btn btn-default js-clearzip"><i class="fa fa-refresh"></i></button></div></div></div></div><?php $_StoreCollection = $this->getStoreCollection(); $totalStoreCount = count($_StoreCollection); if (!$totalStoreCount) : ?> <div class="alert alert-warning"><?php echo __('Please contact the Wausau Homes Support Center to help you get connected to the builder nearest you! contact@wausauhomes.com | (715) 359-7272') ?></div><?php else : ?> <?php $i = 0; foreach ($_StoreCollection as $store) : $i++; ?> <?php $markers[$i]['name'] = '<div class="map-short-info"><h6><a class="title-link" href="' . $block->getUrl('locator/index/view', ['id' => $store->getId()]) . '">' . $store->getName() . '<br><small><b>' . $store->getSubtitle() . '</b></small></a></h6>'; ?> <?php $markers[$i]['lat'] = $store->getLat(); ?> <?php $markers[$i]['long'] = $store->getLng(); ?> <?php $markers[$i]['name'] .= $store->getStreetAddress() . '<br>'; ?> <?php $markers[$i]['name'] .= ' ' . $store->getCity(); ?> <?php $markers[$i]['name'] .= ' ' . $store->getState(); ?> <?php $markers[$i]['name'] .= ' ' . $store->getZipcode(); ?> <?php $markers[$i]['name'] .= ' ' . $store->getCountry(); ?> <?php $markers[$i]['name'] .= '</p>'; ?> <?php if ($store->getPhoneNumber()) : ?> <?php $markers[$i]['name'] .= '<p>' . __('Phone: ') . '<a href="tel:' . $store->getPhoneNumber() . '">' . $store->getPhoneNumber() . '</a></p>'; ?> <?php endif; ?> <?php ?> <?php $markers[$i]['name'] .= '<p><a class="btn btn-sm btn-block-xs btn-primary visitclick-white" href="' . $block->getUrl('locator/index/view', ['id' => $store->getId()]) . '">Learn More <i class="fa fa-angle-double-right"></i></a> <a class="btn btn-sm btn-block-xs btn-primary-o visitclick-blue" href="' . $block->getUrl('locator/index/view', ['id' => $store->getId()]) . '#contact' . '">Contact <i class="fa fa-angle-double-right"></i></a></p>'; ?> <?php $markers[$i]['name'] .= '</div>'; ?> <?php endforeach ?> <?php endif ?> <?php ?> <?php if ($totalStoreCount) : ?> <div id="map" class="map js-map"></div><?php if (is_array($markers) && count($markers) > 0) : ?> <script>
                                            //<![CDATA[
                                            var markers = [
                                                <?php foreach ($markers as $marker) : ?>['<?php echo str_replace("'", "\'", $marker['name']); ?>', <?php echo $marker['lat']; ?>, <?php echo $marker['long']; ?>],
                                                <?php endforeach ?> <?php if ($this->getRequest()->getParam('lat_search') && $this->getRequest()->getParam('long_search')) : ?>
                                                    
                                                <?php endif ?> ];
                                            //]]>
</script><?php endif ?> <?php endif ?> <div class="builder-cat-list panel-group" id="accordion"><div class="page-header"><h2 class="text-uppercase">Browse Custom Home Builders by State</h2><p>Select a state and find a home builder near you.</p></div><?php $allStores = $block->getStoreCollectionWithStateFilter(); if (count($allStores) > 0) { foreach ($allStores as $key => $val) { $classId = strtolower(str_replace(' ', '', $key)); ?> <div class="panel panel-default"><div class="panel-heading" role="tab" id="heading<?php echo $classId ?>"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse<?php echo $classId ?>"><span class="badge pull-right"><?php echo count($val); ?></span> <?php echo __($key) ?></a></h4></div><div id="collapse<?php echo $classId ?>" class="panel-collapse collapse"><div class="panel-body"><div class="row row-sm-flex"><?php foreach ($val as $v1) { ?> <div class="builder"><?php $store_url = $block->getUrl('locator/index/view', ['id' => $v1['store_id']]); if($v1['display_url']){ $store_url = $block->getUrl($v1['display_url']); } ?> <h6 class="text-uppercase"><a class="title-link visitclick-inherit" href="<?= $store_url ?>"><?php echo __($v1['name']) ?> <br><small><b><?php echo __($v1['subtitle']) ?></b></small></a></h6><p><?php echo __($v1['street_address']) ?> <br><?php echo __($v1['city'] . ',' . $v1['state'] . ' ' . $v1['zipcode']) ?> <br><?php echo __($v1['phone_number']) ?></p><p><a class="btn btn-sm btn-block-xs btn-primary visitclick-white" href="<?= $store_url ?>">Learn More <i class="fa fa-angle-double-right"></i></a> <a class="btn btn-sm btn-block-xs btn-primary-o visitclick-blue" href="<?= $store_url.'#contact' ?>">Contact <i class="fa fa-angle-double-right"></i></a></p></div><?php } ?></div></div></div></div><?php } } ?></div></div></form><div class="well well-lg text-center"><h4 class="text-uppercase">Not sure which home builder services your area?</h4><p>Contact us and weâ€™ll get back to you as soon as we can.</p><p><a class="btn btn-text" href="<?php echo $block->getUrl('contact') ?>">Contact Our Main Office <i class="fa fa-angle-double-right"></i></a></p></div></div></div></div></div></div></div><script type="text/javascript">
    var googleMapDivId = 'map';
    require(['jquery', 'MGS_StoreLocator/js/storelocator'], function($) {
        $(window).on('load', function() {
            <?php if ($this->getRequest()->getParam('lat_search') && $this->getRequest()->getParam('long_search')) : ?>
                google.maps.event.addDomListener(window, 'load', drawMapWithCircle(markers, googleMapDivId, <?php echo $this->getRequest()->getParam('lat_search') ?>, <?php echo $this->getRequest()->getParam('long_search') ?>, <?php echo $this->getRequest()->getParam('radius') ?>));
            <?php else : ?>
                google.maps.event.addDomListener(window, 'load', drawMap(markers, googleMapDivId, false, false));
            <?php endif ?> $('#search_radius').click(function() {
                var $form = $('#search_by_distance');
                if ($form.valid()) {
                    $.ajax({
                        type: "GET",
                        dataType: "json",
                        url: "http://maps.googleapis.com/maps/api/geocode/json",
                        data: {
                            'address': $('#location').val(),
                            'sensor': false
                        },
                        success: function(data) {
                            if (data.results.length) {
                                latitude = data.results[0].geometry.location.lat;
                                longitude = data.results[0].geometry.location.lng;
                                $('#lat_search').val(latitude);
                                $('#long_search').val(longitude);

                                $("#search_by_distance").submit();
                            }
                        }
                    });
                }
            });
        });

    });

    require([
        'jquery',
        'jquery/jquery.cookie'
    ], function ($) {
        $(document).ready(function () {
            var utm_s = parseGET('utm_source');
            var utm_m = parseGET('utm_medium');
            var utm_c = parseGET('utm_campaign');
            var utm_t = parseGET('utm_term');
            var utm_cn = parseGET('utm_content');
            if (utm_s && utm_m && utm_c && utm_t && utm_cn) {
                var utm_cokkie = { utm_s, utm_m, utm_c, utm_t, utm_cn };
                var check_cookie = $.cookie('utm_cokkie'); 
                var date = new Date();
                var minutes = 60;
                date.setTime(date.getTime() + (minutes * 60 * 1000));
                $.cookie('utm_cokkie', '', { path: '/', expires: -1 }); 
                $.cookie('utm_cokkie', JSON.stringify(utm_cokkie), {expires: date}); 
            }
        });
    });</script>